import{ag as f,ah as d,ai as m}from"./euVeJPvK.js";function v(){const{subscribe:s,set:c,update:n}=d([]);try{const t=localStorage.getItem("cart");t&&c(JSON.parse(t))}catch(t){console.error("Failed to load cart from storage:",t)}function l(t){try{localStorage.setItem("cart",JSON.stringify(t))}catch(e){console.error("Failed to save cart to storage:",e)}}return{subscribe:s,addItem:(t,e=1)=>{n(r=>{const o=r.findIndex(a=>a.productId===t.productId);return o>=0?r[o].quantity+=e:r.push({...t,quantity:e}),l(r),r})},removeItem:t=>{n(e=>{const r=e.filter(o=>o.productId!==t);return l(r),r})},updateQuantity:(t,e)=>{n(r=>{const o=r.find(a=>a.productId===t);if(o)if(e<=0){const a=r.filter(i=>i.productId!==t);return l(a),a}else return o.quantity=e,l(r),r;return r})},clear:()=>{n(()=>{const t=[];return l(t),t})}}}const y=v();f(y,s=>s.reduce((c,n)=>c+n.price*n.quantity,0));f(y,s=>s.reduce((c,n)=>c+n.quantity,0));({...y});function F(){const{subscribe:s,set:c,update:n}=d(null);try{const t=localStorage.getItem("user");t&&c(JSON.parse(t))}catch(t){console.error("Failed to load user from storage:",t)}function l(t){try{t?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user")}catch(e){console.error("Failed to save user to storage:",e)}}return{subscribe:s,login:t=>{c(t),l(t)},logout:()=>{c(null),l(null)},updateUser:t=>{n(e=>{if(e){const r={...e,...t};return l(r),r}return e})}}}const h=F();f(h,s=>!!s);({...h});const S=globalThis.__sveltekit_1bd4jfe.env,u=new m(S.PUBLIC_POCKETBASE_URL||"https://k.xeon.pl"),I=d(u?.authStore?.record);u&&u.authStore.onChange(s=>{console.log("Auth changed:",s),I.set(u.authStore.record)});function w(){const{subscribe:s,set:c,update:n}=d([]),{subscribe:l,set:t}=d(!1),{subscribe:e,set:r}=d(null);return{subscribe:s,loading:{subscribe:l},error:{subscribe:e},fetchProducts:async o=>{if(u){t(!0),r(null);try{let a="";const i=[];o?.category&&i.push(`categories ~ "${o.category}"`),o?.status?i.push(`status = "${o.status}"`):i.push('status = "active"'),o?.featured!==void 0&&i.push(`featured = ${o.featured}`),o?.search&&i.push(`(name ~ "${o.search}" || shortDescription ~ "${o.search}")`),a=i.join(" && ");const p=await u.collection("products").getList(o?.page||1,o?.limit||50,{filter:a,sort:"-created",expand:"categories"});return c(p.items),p}catch(a){return console.error("Failed to fetch products:",a),r("Failed to load products"),null}finally{t(!1)}}},fetchProduct:async o=>{if(!u)return null;t(!0),r(null);try{let a;return o.length===15?a=await u.collection("products").getOne(o,{expand:"categories"}):a=await u.collection("products").getFirstListItem(`slug="${o}"`,{expand:"categories"}),a}catch(a){return console.error("Failed to fetch product:",a),r("Product not found"),null}finally{t(!1)}},fetchFeaturedProducts:async(o=8)=>{if(u){t(!0),r(null);try{return(await u.collection("products").getList(1,o,{filter:'status = "active" && featured = true',sort:"-created",expand:"categories"})).items}catch(a){return console.error("Failed to fetch featured products:",a),r("Failed to load featured products"),[]}finally{t(!1)}}},addProduct:async o=>{if(!u)return null;t(!0),r(null);try{const a=await u.collection("products").create(o);return n(i=>[...i,a]),a}catch(a){return console.error("Failed to add product:",a),r("Failed to add product"),null}finally{t(!1)}},updateProduct:async(o,a)=>{if(!u)return null;t(!0),r(null);try{const i=await u.collection("products").update(o,a);return n(p=>p.map(g=>g.id===o?{...g,...i}:g)),i}catch(i){return console.error("Failed to update product:",i),r("Failed to update product"),null}finally{t(!1)}},removeProduct:async o=>{if(!u)return!1;t(!0),r(null);try{return await u.collection("products").delete(o),n(a=>a.filter(i=>i.id!==o)),!0}catch(a){return console.error("Failed to remove product:",a),r("Failed to remove product"),!1}finally{t(!1)}},clear:()=>{c([]),r(null)}}}function L(){const{subscribe:s,set:c,update:n}=d([]),{subscribe:l,set:t}=d(!1);return{subscribe:s,loading:{subscribe:l},fetchCategories:async()=>{if(u){t(!0);try{const e=await u.collection("categories").getFullList({sort:"displayOrder,name"});return c(e),e}catch(e){return console.error("Failed to fetch categories:",e),[]}finally{t(!1)}}},fetchFeaturedCategories:async()=>{if(u){t(!0);try{return(await u.collection("categories").getList(1,10,{filter:"featured = true",sort:"displayOrder,name"})).items}catch(e){return console.error("Failed to fetch featured categories:",e),[]}finally{t(!1)}}}}}const b=w();L();f(b,s=>s.filter(c=>c.featured&&c.status==="active"));f(b,s=>s.filter(c=>c.inventory?.trackQuantity?c.inventory.quantity>0:!0));function P(){const{subscribe:s,update:c}=d([]);function n(t){const e=Math.random().toString(36).substr(2,9),r={...t,id:e,duration:t.duration||5e3};return c(o=>[...o,r]),r.duration&&r.duration>0&&setTimeout(()=>{l(e)},r.duration),e}function l(t){c(e=>e.filter(r=>r.id!==t))}return{subscribe:s,success:(t,e)=>n({type:"success",message:t,duration:e}),error:(t,e)=>n({type:"error",message:t,duration:e}),warning:(t,e)=>n({type:"warning",message:t,duration:e}),info:(t,e)=>n({type:"info",message:t,duration:e}),remove:l,clear:()=>c(()=>[])}}const C=P();export{u as a,y as c,C as n,b as p,h as u};
